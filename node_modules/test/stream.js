
// var WsStream = require('websocket-stream');
var WsStream = require('../browser');

function connect() {
  console.log('connecting...');

  var stream = WsStream('ws://localhost:7981/test/WsStream');

  stream.on('data', function(d) { console.log(d); })

  function writeAndLog(what) {
    console.log('write(\'%s\') == %s',
      what.replace(/\n/g, ''),
      stream.write(what));
  }

  writeAndLog('\none');
  writeAndLog('\ttwo');
  writeAndLog('\nthree');
  writeAndLog('\nfour');

  stream.on('open', function() {
    console.log('connected');

    setTimeout(function() { writeAndLog('\ncan I have a little more'); }, 500);
  });

  stream.on('error', function(error) {
    if (error) console.log('Error', error);
  });

  stream.on('close', function() {
    console.log('reconnecting in 1s...');
    setTimeout(connect, 1000);
  });
}

connect();