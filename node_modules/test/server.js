var WebSocketServer = require('ws').Server;
var WsStream = require('..');

var port = 7981;
var server = new WebSocketServer({ port: port });

server.on('connection', onConnection);
server.on('listening', onListening);

function onListening() {
  console.log('listening on port %s', port);
}

var Readable = require('stream').Readable;

process.stdout.setMaxListeners(0);

function onConnection(connection) {
  var readStream  = new Readable();

  var i = 0;
  readStream._read = function() {
    if (++i < 10)
      this.push(i + '');
  };

  var wsstream = WsStream(connection);

  readStream
    .pipe(wsstream)
    .pipe(process.stdout);
}
